# Visual Studio 2019 Build of QuanergyClient

## Prerequisites
These instructions were tested for the following configuration. Please install prerequisites as needed.

* Windows 10 64-bit
* Visual Studio 2019 - Tested with Community Edition available at the time of writing [here](https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=Community&rel=16).
* PowerShell - all command line commands tested in PowerShell.
* Git - Available at the time of writing [here](https://git-scm.com/download/win).
* CMake - Tested with latest version 3.17.2 available at the time of writing [here](https://github.com/Kitware/CMake/releases/download/v3.17.2/cmake-3.17.2-win64-x64.msi). During install, select "Add CMake to the system path for all users."

## Install Dependencies
Install Microsoft vcpkg package manager
```
mkdir C:\QuanergySystems\
cd C:\QuanergySystems\
git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg
.\bootstrap-vcpkg.bat
.\vcpkg integrate install
```
Install PCL and other dependencies from vcpkg. This builds from source and brings in all dependencies so will take some time.
```
.\vcpkg install pcl:x64-windows boost-program-options:x64-windows boost-accumulators:x64-windows
```

## Build Instructions
Clone the SDK repository.
```
cd C:\QuanergySystems\
git clone https://github.com/QuanergySystems/quanergy_client.git
```

Use CMake to configure Visual Studio 2019 Solution
```
cd "C:\QuanergySystems\quanergy_client"
mkdir build
cd build
cmake .. -DCMAKE_TOOLCHAIN_FILE="C:\QuanergySystems\vcpkg\scripts\buildsystems\vcpkg.cmake"
```

Build quanergy_client code and visualizer application in Visual Studio 2019.

* Open QuanergyClient.sln in C:\QuanergySystems\quanergy_client\build\
* Verify "Release" is selected as the Solution Configuration.
* Right-click on ALL_BUILD in the Solution Explorer and select "Build".

## Test build
```
cd C:\QuanergySystems\quanergy_client\build\
.\visualizer.exe --host <IP Address of Sensor>
```

Cloud Viewer window should appear.  When sensor is up to speed, use mouse to manipulate the view of point cloud.

**NOTE:** The point cloud may not appear until the mouse is used to move the view.

## Troubleshooting
* If you are using Cylance SmartProtect AntiVirus, you may get a build failure of VTK due to a Debug DLL being quarantined. To build only release libraries, add `set(VCPKG_BUILD_TYPE release)` to the triplet used for the build (C:\QuanergySystems\vcpkg\triplets\x64-windows.cmake) and rerun the vcpkg install command..

